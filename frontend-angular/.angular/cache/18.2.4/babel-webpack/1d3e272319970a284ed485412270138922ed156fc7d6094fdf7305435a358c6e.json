{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/DELL-GUITAR/Desktop/projectangular/frontend-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { signal } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./api.service\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(api, router) {\n    var _this = this;\n    this.api = api;\n    this.router = router;\n    this._user = signal(null);\n    this.user = this._user.asReadonly();\n    this.loginWithCredentials = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (email, password) {\n        const res = yield _this.api.login({\n          email,\n          password\n        }).toPromise();\n        localStorage.setItem('token', res?.token || '');\n        yield _this.fetchMe();\n        _this.router.navigateByUrl('/home');\n      });\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    const cached = localStorage.getItem('user');\n    if (cached) this._user.set(JSON.parse(cached));\n  }\n  isLoggedIn() {\n    return !!localStorage.getItem('token');\n  }\n  fetchMe() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const me = yield _this2.api.getMe().toPromise();\n        if (me) {\n          _this2._user.set(me);\n          localStorage.setItem('user', JSON.stringify(me));\n        }\n      } catch (e) {\n        // token invalid -> clear\n        _this2.logout(false);\n      }\n    })();\n  }\n  googleLoginRedirect() {\n    window.location.href = '/api/auth/google'; // backend should redirect to Google\n  }\n  logout(redirect = true) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    this._user.set(null);\n    if (redirect) this.router.navigateByUrl('/');\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.ApiService), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","AuthService","constructor","api","router","_this","_user","user","asReadonly","loginWithCredentials","_ref","_asyncToGenerator","email","password","res","login","toPromise","localStorage","setItem","token","fetchMe","navigateByUrl","_x","_x2","apply","arguments","cached","getItem","set","JSON","parse","isLoggedIn","_this2","me","getMe","stringify","e","logout","googleLoginRedirect","window","location","href","redirect","removeItem","i0","ɵɵinject","i1","ApiService","i2","Router","factory","ɵfac","providedIn"],"sources":["C:\\Users\\DELL-GUITAR\\Desktop\\projectangular\\frontend-angular\\src\\app\\core\\services\\auth.service.ts"],"sourcesContent":["\nimport { Injectable, Signal, signal } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ApiService } from './api.service';\n\nexport interface User { id?: string; email?: string; name?: string; role?: 'user'|'admin'; }\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n  private _user = signal<User | null>(null);\n  user: () => User | null = this._user.asReadonly();\n\n  constructor(private api: ApiService, private router: Router) {\n    const cached = localStorage.getItem('user');\n    if (cached) this._user.set(JSON.parse(cached));\n  }\n\n  isLoggedIn(): boolean { return !!localStorage.getItem('token'); }\n\n  async fetchMe() {\n    try {\n      const me = await this.api.getMe().toPromise();\n      if (me) {\n        this._user.set(me);\n        localStorage.setItem('user', JSON.stringify(me));\n      }\n    } catch (e) {\n      // token invalid -> clear\n      this.logout(false);\n    }\n  }\n\n  loginWithCredentials = async (email: string, password: string) => {\n    const res = await this.api.login({ email, password }).toPromise();\n    localStorage.setItem('token', res?.token || '');\n    await this.fetchMe();\n    this.router.navigateByUrl('/home');\n  };\n\n  googleLoginRedirect() {\n    window.location.href = '/api/auth/google'; // backend should redirect to Google\n  }\n\n  logout(redirect: boolean = true) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    this._user.set(null);\n    if (redirect) this.router.navigateByUrl('/');\n  }\n}\n"],"mappings":";AACA,SAA6BA,MAAM,QAAQ,eAAe;;;;AAO1D,OAAM,MAAOC,WAAW;EAItBC,YAAoBC,GAAe,EAAUC,MAAc;IAAA,IAAAC,KAAA;IAAvC,KAAAF,GAAG,GAAHA,GAAG;IAAsB,KAAAC,MAAM,GAANA,MAAM;IAH3C,KAAAE,KAAK,GAAGN,MAAM,CAAc,IAAI,CAAC;IACzC,KAAAO,IAAI,GAAsB,IAAI,CAACD,KAAK,CAACE,UAAU,EAAE;IAsBjD,KAAAC,oBAAoB;MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAOC,KAAa,EAAEC,QAAgB,EAAI;QAC/D,MAAMC,GAAG,SAAST,KAAI,CAACF,GAAG,CAACY,KAAK,CAAC;UAAEH,KAAK;UAAEC;QAAQ,CAAE,CAAC,CAACG,SAAS,EAAE;QACjEC,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEJ,GAAG,EAAEK,KAAK,IAAI,EAAE,CAAC;QAC/C,MAAMd,KAAI,CAACe,OAAO,EAAE;QACpBf,KAAI,CAACD,MAAM,CAACiB,aAAa,CAAC,OAAO,CAAC;MACpC,CAAC;MAAA,iBAAAC,EAAA,EAAAC,GAAA;QAAA,OAAAb,IAAA,CAAAc,KAAA,OAAAC,SAAA;MAAA;IAAA;IAxBC,MAAMC,MAAM,GAAGT,YAAY,CAACU,OAAO,CAAC,MAAM,CAAC;IAC3C,IAAID,MAAM,EAAE,IAAI,CAACpB,KAAK,CAACsB,GAAG,CAACC,IAAI,CAACC,KAAK,CAACJ,MAAM,CAAC,CAAC;EAChD;EAEAK,UAAUA,CAAA;IAAc,OAAO,CAAC,CAACd,YAAY,CAACU,OAAO,CAAC,OAAO,CAAC;EAAE;EAE1DP,OAAOA,CAAA;IAAA,IAAAY,MAAA;IAAA,OAAArB,iBAAA;MACX,IAAI;QACF,MAAMsB,EAAE,SAASD,MAAI,CAAC7B,GAAG,CAAC+B,KAAK,EAAE,CAAClB,SAAS,EAAE;QAC7C,IAAIiB,EAAE,EAAE;UACND,MAAI,CAAC1B,KAAK,CAACsB,GAAG,CAACK,EAAE,CAAC;UAClBhB,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEW,IAAI,CAACM,SAAS,CAACF,EAAE,CAAC,CAAC;QAClD;MACF,CAAC,CAAC,OAAOG,CAAC,EAAE;QACV;QACAJ,MAAI,CAACK,MAAM,CAAC,KAAK,CAAC;MACpB;IAAC;EACH;EASAC,mBAAmBA,CAAA;IACjBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,kBAAkB,CAAC,CAAC;EAC7C;EAEAJ,MAAMA,CAACK,QAAA,GAAoB,IAAI;IAC7BzB,YAAY,CAAC0B,UAAU,CAAC,OAAO,CAAC;IAChC1B,YAAY,CAAC0B,UAAU,CAAC,MAAM,CAAC;IAC/B,IAAI,CAACrC,KAAK,CAACsB,GAAG,CAAC,IAAI,CAAC;IACpB,IAAIc,QAAQ,EAAE,IAAI,CAACtC,MAAM,CAACiB,aAAa,CAAC,GAAG,CAAC;EAC9C;;;uCAxCWpB,WAAW,EAAA2C,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;IAAA;EAAA;;;aAAXhD,WAAW;MAAAiD,OAAA,EAAXjD,WAAW,CAAAkD,IAAA;MAAAC,UAAA,EADE;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}